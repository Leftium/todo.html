// Generated by CoffeeScript 1.6.3
(function() {
  define('store', ['jquery', 'localfile'], function($, localfile) {
    var innerHTML, load, save, todoHtmlRegex;
    innerHTML = window.document.documentElement.innerHTML;
    $(function() {
      var $body, bodyChildren;
      $body = $('body');
      bodyChildren = $('body > *');
      $(bodyChildren).detach();
      window.todotxt = $body.html();
      $body.empty();
      return bodyChildren.appendTo($body);
    });
    todoHtmlRegex = /([\s\S]*)(^!!WARNING!!.Do.not.edit.this.line.[^{]*)([\s\S]*)(!!ENDSTORE!![\s\S]*$)/m;
    load = function() {
      return JSON.parse(innerHTML.replace(todoHtmlRegex, '$3'));
    };
    save = function(store) {
      var jsonStr, newContents, oldContents;
      jsonStr = JSON.stringify(store);
      if (oldContents = localfile.load(localfile.normalizedPath())) {
        newContents = oldContents.replace(todoHtmlRegex, "$1$2" + jsonStr + "$4");
        return localfile.save(localfile.normalizedPath(), newContents);
      }
    };
    return {
      load: load,
      save: save
    };
  });

}).call(this);
